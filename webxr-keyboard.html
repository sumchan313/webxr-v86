<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Hand Tracking Block Grab</title>
  <style>
    canvas { border: 1px solid black; }
    #video { display: none; }
  </style>
</head>
<body>
  <video id="video" autoplay playsinline></video>
  <canvas id="canvas" width="640" height="480"></canvas>

  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const video = document.getElementById('video');

    let blocks = [{x: 100, y: 100, size: 50}, {x: 300, y: 200, size: 50}];
    let grabbedBlock = null;

    function drawBlocks() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      blocks.forEach(block => {
        ctx.fillStyle = 'blue';
        ctx.fillRect(block.x, block.y, block.size, block.size);
      });
    }

    function isPinching(landmarks) {
      const thumbTip = landmarks[4];
      const indexTip = landmarks[8];
      const dx = thumbTip.x - indexTip.x;
      const dy = thumbTip.y - indexTip.y;
      return Math.sqrt(dx*dx + dy*dy) < 0.05;
    }

    function getCursor(landmarks) {
      const tip = landmarks[8];
      return { x: tip.x * canvas.width, y: tip.y * canvas.height };
    }

    const hands = new Hands({locateFile: file => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`});
    hands.setOptions({maxNumHands: 1, modelComplexity: 1, minDetectionConfidence: 0.7});
    hands.onResults(results => {
      drawBlocks();
      if (results.multiHandLandmarks.length > 0) {
        const landmarks = results.multiHandLandmarks[0];
        const cursor = getCursor(landmarks);

        if (isPinching(landmarks)) {
          if (!grabbedBlock) {
            grabbedBlock = blocks.find(b =>
              cursor.x > b.x && cursor.x < b.x + b.size &&
              cursor.y > b.y && cursor.y < b.y + b.size
            );
          }
          if (grabbedBlock) {
            grabbedBlock.x = cursor.x - grabbedBlock.size / 2;
            grabbedBlock.y = cursor.y - grabbedBlock.size / 2;
          }
        } else {
          grabbedBlock = null;
        }

        ctx.beginPath();
        ctx.arc(cursor.x, cursor.y, 10, 0, 2 * Math.PI);
        ctx.fillStyle = 'red';
        ctx.fill();
      }
    });

    const camera = new Camera(video, {
      onFrame: async () => await hands.send({image: video}),
      width: 640,
      height: 480
    });
    camera.start();
  </script>
</body>
</html>
